<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Visual Novel Chat</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth-compat.js"></script>
    <script src="../js/firebase-config.js"></script>
</head>
<body>

    <div class="vn-background"></div>

    <div class="vn-character-container">
        <img id="char-sprite" src="" alt="Character Sprite">
    </div>

    <div class="vn-ui-layer">
        
        <div class="top-buttons">
            <button id="btn-back" class="icon-btn" title="Kembali ke Lobi">â†©ï¸ Kembali</button>

            <div class="right-tools">
                <button id="btn-log" class="icon-btn" title="Lihat Riwayat">ğŸ“œ Riwayat</button>
                <button id="btn-settings" class="icon-btn" title="Pengaturan User">âš™ï¸ Atur</button>
                <button id="btn-delete-history" class="icon-btn danger" title="Hapus Memori">ğŸ—‘ï¸ Reset</button>
            </div>
        </div>

        <div class="dialogue-box">
            <div class="name-tag" id="char-name">Loading...</div>
            <div class="text-content" id="dialogue-text">Menghubungkan ke server...</div>
            
            <div class="input-area">
                <input type="text" id="user-input" placeholder="Ketik pesan..." autocomplete="off">
                <button id="btn-send">â¤</button>
            </div>
        </div>
    </div>

    <div id="log-overlay" class="overlay hidden">
        <div class="log-box">
            <div class="log-header">
                <h3>Riwayat Percakapan</h3>
                <button id="close-log">âœ–</button>
            </div>
            <div id="log-content"></div>
        </div>
    </div>

    <div id="settings-overlay" class="overlay hidden">
        <div class="modal-box">
            <h3 style="margin-top:0; color:#5a8aa8;">Pengaturan User</h3>
            
            <div class="form-group" style="margin-bottom:15px;">
                <label style="display:block; font-weight:bold; margin-bottom:5px;">Nama Panggilan:</label>
                <input type="text" id="setting-username" placeholder="Contoh: Tuan Cecep" 
                       style="width:100%; padding:8px; border:1px solid #ddd; border-radius:6px;">
            </div>

            <div class="form-group" style="margin-bottom:15px;">
                <label style="display:block; font-weight:bold; margin-bottom:5px;">Peran / Persona Kamu:</label>
                <textarea id="setting-persona" rows="3" 
                          placeholder="Contoh: Saya adalah atasan kamu yang tegas tapi baik hati."
                          style="width:100%; padding:8px; border:1px solid #ddd; border-radius:6px; font-family:inherit;"></textarea>
                <small style="color:#666;">Jelaskan siapa kamu bagi karakter ini.</small>
            </div>

            <div style="text-align:right; gap:10px; display:flex; justify-content:flex-end;">
                <button id="btn-close-settings" style="background:#ccc; border:none; padding:8px 16px; border-radius:6px; cursor:pointer;">Batal</button>
                <button id="btn-save-settings" style="background:#8ecae6; border:none; padding:8px 16px; border-radius:6px; cursor:pointer; color:#fff; font-weight:bold;">Simpan</button>
            </div>
        </div>
    </div>

    <div id="custom-confirm-modal" class="overlay" style="display: none;">
        <div class="modal-box confirm-box">
            <h3 id="confirm-title">Konfirmasi</h3>
            <p id="confirm-msg">Apakah Anda yakin?</p>
            <div class="modal-actions">
                <button id="btn-confirm-cancel" class="btn-cancel">Batal</button>
                <button id="btn-confirm-yes" class="btn-yes">Ya, Lakukan</button>
            </div>
        </div>
    </div>

    <div id="custom-alert-modal" class="overlay hidden">
        <div class="modal-box" style="text-align: center;">
            <h3 id="alert-title" style="color: #023047; margin-top: 0;">Notifikasi</h3>
            <p id="alert-msg" style="color: #333; font-size: 16px; margin: 20px 0;">
                Pesan notifikasi...
            </p>
            <button id="btn-alert-ok" class="vn-btn-primary">
                OK, Mengerti
            </button>
        </div>
    </div>

    <div id="level-up-overlay" class="level-up-overlay hidden">
    <div class="level-up-box">
        <div class="level-stars">â­â­â­</div>
        <h1 class="level-title">LEVEL UP!</h1>
        <div class="level-number-container">
            <span class="level-label">LEVEL</span>
            <span id="new-level-display">2</span>
        </div>
        <p class="level-msg">Hebat! Kamu semakin sepuh!</p>
        <button id="btn-close-level" class="level-btn">Lanjut Cerita â–¶ï¸</button>
    </div>
    <div class="confetti c1"></div>
    <div class="confetti c2"></div>
    <div class="confetti c3"></div>
    <div class="confetti c4"></div>
    </div>

    <div id="mode-selection-modal" class="overlay hidden" style="display: none;">
        <div class="modal-box" style="text-align: center; max-width: 400px;">
            <h3 style="color: #023047; margin-top: 0;">Pilih Mode Chat</h3>
            <p style="color: #555; font-size: 0.9rem; margin-bottom: 20px;">
                Mau ngobrol santai atau mainkan cerita?
            </p>

            <div style="display: flex; flex-direction: column; gap: 10px;">
                <button id="btn-mode-free" class="mode-btn" style="
                    background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%);
                    border: none; padding: 15px; border-radius: 12px;
                    text-align: left; cursor: pointer; transition: transform 0.2s;
                    box-shadow: 0 4px 6px rgba(0,0,0,0.1);
                ">
                    <strong style="display:block; color:#333; font-size:1.1rem;">â˜• Free Talk</strong>
                    <small style="color:#555;">Ngobrol bebas tanpa skenario. Curhat sepuasnya.</small>
                </button>

                <button id="btn-mode-story" class="mode-btn" style="
                    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                    border: none; padding: 15px; border-radius: 12px;
                    text-align: left; cursor: pointer; transition: transform 0.2s;
                    box-shadow: 0 4px 6px rgba(0,0,0,0.1);
                ">
                    <strong style="display:block; color:#fff; font-size:1.1rem;">ğŸ® Story Mode</strong>
                    <small style="color:#e0e0e0;">Ikuti alur cerita, tentukan pilihanmu, capai endingnya!</small>
                </button>
            </div>

            <button id="btn-cancel-mode" style="margin-top: 20px; background: transparent; border: none; color: #888; cursor: pointer;">
                Batal
            </button>
        </div>
    </div>

    <script src="chat.js"></script>
</body>
</html>